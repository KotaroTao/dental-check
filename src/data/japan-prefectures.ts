// 日本の都道府県ポリゴンデータ（簡略化版）
// 各都道府県の代表的な境界座標

export interface PrefectureFeature {
  type: "Feature";
  properties: {
    name: string;
    name_en: string;
  };
  geometry: {
    type: "Polygon" | "MultiPolygon";
    coordinates: number[][][] | number[][][][];
  };
}

export interface JapanGeoJSON {
  type: "FeatureCollection";
  features: PrefectureFeature[];
}

// 都道府県の中心座標（ポリゴンが表示されない場合のフォールバック用）
export const PREFECTURE_CENTERS: Record<string, [number, number]> = {
  "北海道": [43.0646, 141.3468],
  "青森県": [40.8244, 140.7399],
  "岩手県": [39.7036, 141.1526],
  "宮城県": [38.2688, 140.8721],
  "秋田県": [39.7186, 140.1023],
  "山形県": [38.2404, 140.3633],
  "福島県": [37.7500, 140.4678],
  "茨城県": [36.3418, 140.4468],
  "栃木県": [36.5657, 139.8836],
  "群馬県": [36.3906, 139.0604],
  "埼玉県": [35.8570, 139.6489],
  "千葉県": [35.6046, 140.1233],
  "東京都": [35.6895, 139.6917],
  "神奈川県": [35.4478, 139.6425],
  "新潟県": [37.9024, 139.0232],
  "富山県": [36.6953, 137.2114],
  "石川県": [36.5946, 136.6256],
  "福井県": [36.0652, 136.2216],
  "山梨県": [35.6642, 138.5684],
  "長野県": [36.6513, 138.1810],
  "岐阜県": [35.3912, 136.7223],
  "静岡県": [34.9769, 138.3831],
  "愛知県": [35.1802, 136.9066],
  "三重県": [34.7303, 136.5086],
  "滋賀県": [35.0045, 135.8686],
  "京都府": [35.0214, 135.7556],
  "大阪府": [34.6864, 135.5200],
  "兵庫県": [34.6913, 135.1830],
  "奈良県": [34.6851, 135.8329],
  "和歌山県": [34.2260, 135.1675],
  "鳥取県": [35.5039, 134.2377],
  "島根県": [35.4723, 133.0505],
  "岡山県": [34.6618, 133.9344],
  "広島県": [34.3966, 132.4596],
  "山口県": [34.1859, 131.4714],
  "徳島県": [34.0658, 134.5593],
  "香川県": [34.3401, 134.0434],
  "愛媛県": [33.8417, 132.7657],
  "高知県": [33.5597, 133.5311],
  "福岡県": [33.6064, 130.4183],
  "佐賀県": [33.2494, 130.2988],
  "長崎県": [32.7448, 129.8737],
  "熊本県": [32.7898, 130.7417],
  "大分県": [33.2382, 131.6126],
  "宮崎県": [31.9111, 131.4239],
  "鹿児島県": [31.5602, 130.5581],
  "沖縄県": [26.2124, 127.6809],
};

// 都道府県名の正規化（APIレスポンスとのマッチング用）
export function normalizePrefectureName(name: string): string {
  // 「県」「府」「都」「道」を含まない場合は追加
  if (!name.endsWith("県") && !name.endsWith("府") && !name.endsWith("都") && !name.endsWith("道")) {
    if (name === "東京") return "東京都";
    if (name === "大阪") return "大阪府";
    if (name === "京都") return "京都府";
    if (name === "北海道") return "北海道";
    return name + "県";
  }
  return name;
}

// 都道府県のバウンディングボックス（簡略化版）
// [minLng, minLat, maxLng, maxLat]
export const PREFECTURE_BOUNDS: Record<string, [number, number, number, number]> = {
  "北海道": [139.3, 41.3, 145.9, 45.6],
  "青森県": [139.4, 40.2, 141.7, 41.6],
  "岩手県": [140.0, 38.7, 142.1, 40.5],
  "宮城県": [140.2, 37.8, 141.7, 39.0],
  "秋田県": [139.7, 39.0, 140.9, 40.5],
  "山形県": [139.5, 37.7, 140.6, 39.2],
  "福島県": [139.2, 36.8, 141.1, 38.0],
  "茨城県": [139.7, 35.7, 140.9, 36.9],
  "栃木県": [139.3, 36.2, 140.3, 37.2],
  "群馬県": [138.4, 36.0, 139.7, 37.1],
  "埼玉県": [138.7, 35.7, 139.9, 36.3],
  "千葉県": [139.7, 34.9, 140.9, 36.1],
  "東京都": [138.9, 35.5, 139.9, 35.9],
  "神奈川県": [138.9, 35.1, 139.8, 35.7],
  "新潟県": [137.8, 37.0, 140.0, 38.6],
  "富山県": [136.7, 36.3, 137.8, 37.0],
  "石川県": [136.2, 36.1, 137.4, 37.9],
  "福井県": [135.4, 35.4, 136.9, 36.3],
  "山梨県": [138.2, 35.2, 139.2, 35.9],
  "長野県": [137.3, 35.2, 138.8, 37.0],
  "岐阜県": [136.3, 35.1, 137.7, 36.5],
  "静岡県": [137.5, 34.6, 139.2, 35.6],
  "愛知県": [136.7, 34.6, 137.8, 35.4],
  "三重県": [135.8, 33.7, 137.0, 35.1],
  "滋賀県": [135.8, 34.8, 136.5, 35.7],
  "京都府": [134.8, 34.7, 136.1, 35.8],
  "大阪府": [135.1, 34.3, 135.8, 35.1],
  "兵庫県": [134.2, 34.2, 135.5, 35.7],
  "奈良県": [135.5, 33.9, 136.2, 34.8],
  "和歌山県": [135.0, 33.4, 136.1, 34.4],
  "鳥取県": [133.2, 35.1, 134.5, 35.6],
  "島根県": [131.7, 34.3, 133.4, 35.6],
  "岡山県": [133.3, 34.4, 134.4, 35.4],
  "広島県": [132.0, 34.0, 133.5, 35.1],
  "山口県": [130.8, 33.7, 132.1, 34.8],
  "徳島県": [133.6, 33.5, 134.8, 34.3],
  "香川県": [133.6, 34.1, 134.5, 34.5],
  "愛媛県": [132.0, 32.9, 133.7, 34.3],
  "高知県": [132.5, 32.7, 134.3, 33.9],
  "福岡県": [130.0, 33.0, 131.2, 34.0],
  "佐賀県": [129.7, 33.0, 130.6, 33.6],
  "長崎県": [128.6, 32.6, 130.4, 34.7],
  "熊本県": [130.1, 32.1, 131.3, 33.2],
  "大分県": [130.9, 32.7, 132.1, 33.8],
  "宮崎県": [130.8, 31.4, 131.9, 32.8],
  "鹿児島県": [128.4, 27.0, 131.2, 32.3],
  "沖縄県": [122.9, 24.0, 131.3, 27.9],
};

// 都道府県の簡略化ポリゴン座標
// 実際のGeoJSONデータは大きいため、ここでは都道府県の境界ボックスから簡略化したポリゴンを生成
export function generateSimplifiedPolygon(prefName: string): number[][] {
  const bounds = PREFECTURE_BOUNDS[prefName];
  if (!bounds) return [];

  const [minLng, minLat, maxLng, maxLat] = bounds;

  // 矩形を返す（簡略化版）
  return [
    [minLng, minLat],
    [maxLng, minLat],
    [maxLng, maxLat],
    [minLng, maxLat],
    [minLng, minLat], // 閉じる
  ];
}

// 都道府県GeoJSONを生成
export function getJapanGeoJSON(): JapanGeoJSON {
  const features: PrefectureFeature[] = Object.keys(PREFECTURE_BOUNDS).map((name) => ({
    type: "Feature" as const,
    properties: {
      name,
      name_en: name, // 簡略化のため同じ値を使用
    },
    geometry: {
      type: "Polygon" as const,
      coordinates: [generateSimplifiedPolygon(name)],
    },
  }));

  return {
    type: "FeatureCollection",
    features,
  };
}

// 都道府県リスト
export const PREFECTURES = [
  "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
  "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
  "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県",
  "岐阜県", "静岡県", "愛知県", "三重県",
  "滋賀県", "京都府", "大阪府", "兵庫県", "奈良県", "和歌山県",
  "鳥取県", "島根県", "岡山県", "広島県", "山口県",
  "徳島県", "香川県", "愛媛県", "高知県",
  "福岡県", "佐賀県", "長崎県", "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県",
];
